<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Bloom & Thread â€” Contact Us</title>

<!-- Fonts & Icons -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Great+Vibes&display=swap" rel="stylesheet" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
  body {
    margin: 0;
    font-family: 'Poppins', sans-serif;
    background: #fff0f5;
    color: #4a2c2a;
  }
  .background-overlay {
    background: url('thread.png') no-repeat center center fixed;
    background-size: cover;
    filter: blur(1px) brightness(1);
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
  }
  /* Navbar */
  .navbar { width: 100%; background: rgba(94,54,110,0.9); position: sticky; top: 0; z-index: 1000; }
  .nav-container { max-width: 1700px; margin: 0 auto; padding: 23px 30px; display: flex; justify-content: space-between; align-items: center; }
  .logo { font-family: 'Great Vibes', cursive; color: #ffffff; font-size: 1.8rem; text-decoration: none; }
  .nav-links { list-style: none; display: flex; gap: 25px; margin: 0; padding: 0; }
  .nav-links li a { color: #ffffff; text-decoration: none; font-weight: 500; transition: color 0.3s; }
  .nav-links li a:hover, .nav-links li a.active { color: #ffb6c1; }

  /* Contact Form */
  .contact-container { max-width: 700px; margin: 80px auto 40px; background: rgba(255,240,245,0.9); padding: 25px; border-radius: 15px; box-shadow: 0 4px 20px rgba(255,182,193,0.4); }
  .contact-container h1 { text-align: center; color: #b85c8a; font-family: 'Great Vibes', cursive; font-size: 2rem; margin-bottom: 10px; }
  .contact-container p { text-align: center; margin-bottom: 20px; color: #5e366e; }
  .contact-container form input, .contact-container form select, .contact-container form textarea, .contact-container form button {
    width: 100%; margin-bottom: 15px; padding: 10px 15px; border-radius: 8px; border: 1px solid #ccc; font-size: 1rem;
  }
  .contact-container form button { background: #5e366e; color: #fff; border: none; cursor: pointer; transition: 0.3s; }
  .contact-container form button:hover { background: #ffb6c1; color: #4a2c2a; transform: scale(1.05); }

  .image-preview img { width: 80px; height: 80px; object-fit: cover; border-radius: 10px; margin: 5px; cursor: pointer; }

  /* Dashboard */
  .dashboard { max-width: 900px; margin: 50px auto; background: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
  .dashboard h2 { color: #d97b9d; text-align: center; margin-bottom: 20px; }
  .request { border-bottom: 1px solid #eee; padding: 15px 0; }
  .request:last-child { border-bottom: none; }
  .status-badge { display: inline-block; padding: 4px 10px; border-radius: 6px; font-size: 13px; color: #fff; }
  .status-Pending { background: #ffafcc; }
  .status-InProgress { background: #f4a261; }
  .status-Resolved { background: #80ed99; }
  .image-gallery img { width: 80px; height: 80px; object-fit: cover; border-radius: 10px; margin: 5px; cursor: pointer; transition: transform 0.2s; }
  .image-gallery img:hover { transform: scale(1.1); }

  footer { background: #5e366e; color: #fff; text-align: center; padding: 20px 0; margin-top: 40px; font-size: 0.95rem; }
</style>
</head>
<body>

<div class="background-overlay"></div>

<!-- Navbar -->
<nav class="navbar">
  <div class="nav-container">
    <a href="index.html" class="logo">Bloom & Thread</a>
    <ul class="nav-links">
      <li><a href="index.html">Home</a></li>
      <li><a href="collection.html">Collection</a></li>
      <li><a href="cart.html">Cart</a></li>
      <li><a href="order.html">Order</a></li>
      <li><a href="reviews.html">Reviews</a></li>
      <li><a href="contactus.html" class="active">Contact Us</a></li>
      <li><a href="policies.html">Policies</a></li>
      <li><a href="logout.html">Logout</a></li>
    </ul>
  </div>
</nav>

<!-- Contact Form -->
<div class="contact-container">
  <h1>Contact Us ðŸ’Œ</h1>
  <p>If you have issues about your order, refunds, or product quality â€” weâ€™re here to help!</p>

  <form id="contactForm">
    <input type="text" id="name" placeholder="Your Name" required />
    <input type="email" id="email" placeholder="Your Email" required />
    <select id="reason" required>
      <option value="">Select Reason</option>
      <option value="Refund Request">Refund Request</option>
      <option value="Damaged Product">Damaged Product</option>
      <option value="Late Delivery">Late Delivery</option>
      <option value="Other">Other</option>
    </select>
    <textarea id="message" placeholder="Write your message here..." required></textarea>
    <input type="file" id="proof" accept="image/*" multiple />
    <div class="image-preview" id="imagePreview"></div>
    <button type="submit">Submit</button>
  </form>
</div>

<!-- Dashboard Section -->
<div class="dashboard">
  <h2>ðŸ“¬ My Requests</h2>
  <div id="requestsList"></div>
</div>

<footer>
  <p>Â© 2025 Bloom & Thread â€” Every Stitch Tells a Story.</p>
</footer>

<script>
  // Render requests with live status editing
  function renderRequests() {
    const list = document.getElementById("requestsList");
    const data = JSON.parse(localStorage.getItem("bloom_contact_requests")) || [];
    
    list.innerHTML = data.length === 0
      ? "<p>No requests yet.</p>"
      : data.map((r, i) => `
          <div class="request" data-index="${i}">
            <p><strong>Name:</strong> ${r.name}</p>
            <p><strong>Email:</strong> ${r.email}</p>
            <p><strong>Reason:</strong> ${r.reason}</p>
            <p><strong>Message:</strong> ${r.message}</p>
            <div class="image-gallery">
              ${(r.images || []).map(img => `<img src="${img}" onclick="window.open('${img}')">`).join('')}
            </div>
            <p><strong>Status:</strong> 
              <select class="status-select">
                <option value="Pending" ${r.status === 'Pending' ? 'selected' : ''}>Pending</option>
                <option value="InProgress" ${r.status === 'InProgress' ? 'selected' : ''}>In Progress</option>
                <option value="Resolved" ${r.status === 'Resolved' ? 'selected' : ''}>Resolved</option>
              </select>
              <span class="status-badge status-${r.status.replace(/\s/g,'')}">${r.status}</span>
            </p>
            <hr>
          </div>
        `).join('');

    document.querySelectorAll('.status-select').forEach(select => {
      select.addEventListener('change', function() {
        const parent = this.closest('.request');
        const idx = parent.dataset.index;
        const requests = JSON.parse(localStorage.getItem('bloom_contact_requests')) || [];
        const prevStatus = requests[idx].status;

        // Update status
        requests[idx].status = this.value;
        localStorage.setItem('bloom_contact_requests', JSON.stringify(requests));

        // Re-render to update badge
        renderRequests();
      });
    });
  }

  // Re-render on localStorage changes (live sync with Admin)
  window.addEventListener("storage", e => {
    if(e.key === "bloom_contact_requests") renderRequests();
  });

  // Initial render
  renderRequests();

  // Image preview for uploaded files
  document.getElementById('proof').addEventListener('change', function() {
    const preview = document.getElementById('imagePreview');
    preview.innerHTML = '';
    Array.from(this.files).forEach(file => {
      const reader = new FileReader();
      reader.onload = e => {
        const img = document.createElement('img');
        img.src = e.target.result;
        preview.appendChild(img);
      };
      reader.readAsDataURL(file);
    });
  });

  // Handle form submission
  document.getElementById('contactForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const name = document.getElementById('name').value.trim();
    const email = document.getElementById('email').value.trim();
    const reason = document.getElementById('reason').value;
    const message = document.getElementById('message').value.trim();
    const files = document.getElementById('proof').files;
    const images = [];

    if (files.length) {
      let loaded = 0;
      Array.from(files).forEach(file => {
        const reader = new FileReader();
        reader.onload = function(event) {
          images.push(event.target.result);
          loaded++;
          if (loaded === files.length) saveRequest();
        };
        reader.readAsDataURL(file);
      });
    } else {
      saveRequest();
    }

    function saveRequest() {
      const requests = JSON.parse(localStorage.getItem('bloom_contact_requests')) || [];
      requests.push({ name, email, reason, message, images, status: 'Pending' });
      localStorage.setItem('bloom_contact_requests', JSON.stringify(requests));
      document.getElementById('contactForm').reset();
      document.getElementById('imagePreview').innerHTML = '';
      renderRequests();
      alert('Your request has been submitted!');
    }
  });
</script>

</body>
</html>
